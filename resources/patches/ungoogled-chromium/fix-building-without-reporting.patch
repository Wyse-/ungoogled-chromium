# Fix building with enable_reporting=false
# In profile_impl_io_data.h/cc and reporting_service_proxy.cc the devs forgot to check if reporting was enabled before using a reporting feature
# In printer_handler.cc, due to some combination of build flags used in the ungoogled-chromium build, MakeUnique was not pulled in

--- a/chrome/browser/ui/webui/print_preview/printer_handler.cc
+++ b/chrome/browser/ui/webui/print_preview/printer_handler.cc
@@ -8,6 +8,7 @@
 #include "chrome/browser/ui/webui/print_preview/extension_printer_handler.h"
 #include "chrome/browser/ui/webui/print_preview/pdf_printer_handler.h"
 #include "chrome/common/features.h"
+#include "base/memory/ptr_util.h"
 
 #if BUILDFLAG(ENABLE_SERVICE_DISCOVERY)
 #include "chrome/browser/ui/webui/print_preview/privet_printer_handler.h"
--- a/content/browser/net/reporting_service_proxy.cc
+++ b/content/browser/net/reporting_service_proxy.cc
@@ -60,6 +60,7 @@ class ReportingServiceProxyImpl : public
                    const std::string& group,
                    const std::string& type,
                    std::unique_ptr<base::Value> body) {
+#if BUILDFLAG(ENABLE_REPORTING)
     net::URLRequestContext* request_context =
         request_context_getter_->GetURLRequestContext();
     if (!request_context) {
@@ -75,6 +76,7 @@ class ReportingServiceProxyImpl : public
     }
 
     reporting_service->QueueReport(url, group, type, std::move(body));
+#endif
   }
 
   scoped_refptr<net::URLRequestContextGetter> request_context_getter_;
--- a/chrome/browser/profiles/profile_impl_io_data.h
+++ b/chrome/browser/profiles/profile_impl_io_data.h
@@ -194,6 +194,7 @@ class ProfileImplIOData : public Profile
       const StoragePartitionDescriptor& partition_descriptor) const override;
   chrome_browser_net::Predictor* GetPredictor() override;
 
+#if BUILDFLAG(ENABLE_REPORTING)
   // Returns a net::ReportingService, if reporting should be enabled. Otherwise,
   // returns nullptr.
   // TODO(mmenke): Remove once URLRequestContextBuilders are always used to
@@ -204,6 +205,7 @@ class ProfileImplIOData : public Profile
   // Returns a net::ReportingPolicy, if reporting should be enabled. Otherwise,
   // returns nullptr.
   static std::unique_ptr<net::ReportingPolicy> MaybeCreateReportingPolicy();
+#endif
 
   // Lazy initialization params.
   mutable std::unique_ptr<LazyParams> lazy_params_;
--- a/chrome/browser/profiles/profile_impl_io_data.cc
+++ b/chrome/browser/profiles/profile_impl_io_data.cc
@@ -481,7 +481,9 @@
       builder, std::move(request_interceptors),
       std::move(profile_params->protocol_handler_interceptor));
 
+#if BUILDFLAG(ENABLE_REPORTING)
   builder->set_reporting_policy(MaybeCreateReportingPolicy());
+#endif
 }
 
 void ProfileImplIOData::OnMainRequestContextCreated(
@@ -617,7 +619,9 @@
           context->host_resolver()));
   context->SetJobFactory(std::move(top_job_factory));
 
+#if BUILDFLAG(ENABLE_REPORTING)
   context->SetReportingService(MaybeCreateReportingService(context));
+#endif
 
   return context;
 }
@@ -707,6 +711,7 @@
   return predictor_.get();
 }
 
+#if BUILDFLAG(ENABLE_REPORTING)
 std::unique_ptr<net::ReportingService>
 ProfileImplIOData::MaybeCreateReportingService(
     net::URLRequestContext* url_request_context) const {
@@ -725,3 +730,4 @@
 
   return base::MakeUnique<net::ReportingPolicy>();
 }
+#endif
